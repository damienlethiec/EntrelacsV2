<% content_for :page_header do %>
  <div class="flex items-center justify-between">
    <h1 class="text-3xl font-bold tracking-tight text-gray-900"><%= t("residences.index.title") %></h1>
    <% if policy(Residence).create? %>
      <%= link_to t("residences.index.new"), new_residence_path,
          class: "rounded-md bg-tisseurs-teal px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-tisseurs-teal-dark focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-tisseurs-teal" %>
    <% end %>
  </div>
<% end %>

<% if current_user.admin? %>
  <div class="mb-6">
    <% if params[:show_deleted] == "true" %>
      <%= link_to t("residences.index.hide_deleted"), residences_path, class: "text-sm text-tisseurs-teal hover:text-tisseurs-teal-dark" %>
    <% else %>
      <%= link_to t("residences.index.show_deleted"), residences_path(show_deleted: true), class: "text-sm text-gray-500 hover:text-gray-700" %>
    <% end %>
  </div>
<% end %>

<% if @residences.any? %>
  <div class="overflow-hidden bg-white shadow ring-1 ring-black/5 sm:rounded-lg">
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"><%= t("activerecord.attributes.residence.name") %></th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"><%= t("activerecord.attributes.residence.address") %></th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"><%= t("residences.index.weavers") %></th>
          <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
            <span class="sr-only"><%= t("helpers.actions") %></span>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% @residences.each do |residence| %>
          <tr class="<%= 'bg-red-50' if residence.deleted? %>">
            <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">
              <%= link_to residence.name, residence, class: "hover:text-tisseurs-teal" %>
              <% if residence.deleted? %>
                <span class="ml-2 inline-flex items-center rounded-md bg-red-100 px-2 py-1 text-xs font-medium text-red-700"><%= t("residences.status.deleted") %></span>
              <% end %>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"><%= truncate(residence.address, length: 50) %></td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
              <%= residence.users.weaver.map(&:full_name).join(", ").presence || "-" %>
            </td>
            <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
              <%= link_to t("helpers.show"), residence, class: "text-tisseurs-teal hover:text-tisseurs-teal-dark" %>
              <% if policy(residence).edit? %>
                <span class="mx-1 text-gray-300">|</span>
                <%= link_to t("helpers.edit"), edit_residence_path(residence), class: "text-tisseurs-teal hover:text-tisseurs-teal-dark" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="text-center py-12">
    <svg class="mx-auto size-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
    </svg>
    <h3 class="mt-2 text-sm font-semibold text-gray-900"><%= t("residences.index.empty") %></h3>
    <% if policy(Residence).create? %>
      <p class="mt-1 text-sm text-gray-500"><%= t("residences.index.empty_hint") %></p>
      <div class="mt-6">
        <%= link_to new_residence_path, class: "inline-flex items-center rounded-md bg-tisseurs-teal px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-tisseurs-teal-dark" do %>
          <svg class="-ml-0.5 mr-1.5 size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
          </svg>
          <%= t("residences.index.new") %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
