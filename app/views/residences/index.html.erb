<% content_for :page_header do %>
  <div class="md:flex md:items-center md:justify-between">
    <div class="min-w-0 flex-1">
      <h1 class="text-2xl/7 font-bold text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight"><%= t("residences.index.title") %></h1>
    </div>
    <% if policy(Residence).create? %>
      <div class="mt-4 flex md:mt-0 md:ml-4">
        <%= link_to t("residences.index.new"), new_residence_path,
            class: "inline-flex items-center rounded-md bg-tisseurs-teal px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-tisseurs-teal-dark focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-tisseurs-teal" %>
      </div>
    <% end %>
  </div>
<% end %>

<% if current_user.admin? %>
  <div class="mb-6">
    <% if params[:show_deleted] == "true" %>
      <%= link_to t("residences.index.hide_deleted"), residences_path, class: "text-sm text-tisseurs-teal hover:text-tisseurs-teal-dark" %>
    <% else %>
      <%= link_to t("residences.index.show_deleted"), residences_path(show_deleted: true), class: "text-sm text-gray-500 hover:text-gray-700" %>
    <% end %>
  </div>
<% end %>

<% if @residences.any? %>
  <div class="bg-white shadow ring-1 ring-black/5 sm:rounded-lg">
    <ul role="list" class="divide-y divide-gray-100">
      <% @residences.each do |residence| %>
        <li class="flex items-center justify-between gap-x-6 py-5 px-4 sm:px-6 <%= 'bg-red-50' if residence.deleted? %>">
          <div class="min-w-0">
            <div class="flex items-start gap-x-3">
              <%= link_to residence.name, residence_activities_path(residence),
                  class: "text-sm/6 font-semibold text-tisseurs-teal hover:text-tisseurs-teal-dark" %>
              <% if residence.deleted? %>
                <span class="mt-0.5 rounded-md bg-red-100 px-1.5 py-0.5 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10"><%= t("residences.status.deleted") %></span>
              <% end %>
            </div>
            <div class="mt-1 text-xs/5 text-gray-500">
              <p class="truncate"><%= residence.address %></p>
              <% residence.users.weaver.each do |weaver| %>
                <p class="truncate mt-0.5">
                  <span class="font-medium"><%= weaver.full_name %></span>
                  <% if weaver.email.present? %>
                    - <%= weaver.email %>
                  <% end %>
                  <% if weaver.phone.present? %>
                    - <%= weaver.phone %>
                  <% end %>
                </p>
              <% end %>
            </div>
          </div>
          <%= render "shared/action_menu" do %>
            <%= link_to t("residences.index.view_residents"), residence_residents_path(residence),
                class: "block px-3 py-1 text-sm/6 text-gray-900 hover:bg-gray-50" %>
            <% if current_user.admin? %>
              <%= link_to t("helpers.edit"), edit_residence_path(residence),
                  class: "block px-3 py-1 text-sm/6 text-gray-900 hover:bg-gray-50" %>
              <% unless residence.deleted? %>
                <%= button_to t("helpers.delete"), residence_path(residence), method: :delete,
                    form: { data: { turbo_confirm: t("residences.confirm_delete", name: residence.name) } },
                    class: "block w-full text-left px-3 py-1 text-sm/6 text-tisseurs-coral hover:bg-gray-50" %>
              <% end %>
              <% if residence.deleted? %>
                <%= button_to t("residences.restore"), restore_residence_path(residence), method: :patch,
                    class: "block w-full text-left px-3 py-1 text-sm/6 text-tisseurs-teal hover:bg-gray-50" %>
              <% end %>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>
<% else %>
  <div class="text-center py-12">
    <svg class="mx-auto size-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
    </svg>
    <h3 class="mt-2 text-sm font-semibold text-gray-900"><%= t("residences.index.empty") %></h3>
    <% if policy(Residence).create? %>
      <p class="mt-1 text-sm text-gray-500"><%= t("residences.index.empty_hint") %></p>
      <div class="mt-6">
        <%= link_to new_residence_path, class: "inline-flex items-center rounded-md bg-tisseurs-teal px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-tisseurs-teal-dark" do %>
          <svg class="-ml-0.5 mr-1.5 size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
          </svg>
          <%= t("residences.index.new") %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
